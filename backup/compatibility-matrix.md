# Матрица совместимости версий

Этот документ описывает совместимость между различными компонентами стека и их версиями. Рекомендуется сверяться с этой таблицей при обновлении компонентов.

## Общая матрица совместимости

| Компонент | Версия | Совместимые компоненты | Несовместимые компоненты | Зависимости |
|-----------|--------|------------------------|--------------------------|-------------|
| n8n | 1.20.0 | Redis 7.x, PostgreSQL 14/15 с pgvector | | PostgreSQL, Redis |
| PostgreSQL+pgvector | v0.5.0 | n8n 1.x, Flowise 1.x | | - |
| Redis | 7.2.4 | n8n 1.x | | - |
| Adminer | 4.8.1 | PostgreSQL 14/15, MariaDB 10.x | | - |
| Caddy | 2.7.5 | Все компоненты | | - |
| Flowise | 1.4.10 | Qdrant 1.5+, Node.js 18+ | | - |
| Qdrant | v1.6.1 | Flowise 1.4+, n8n 1.x | | - |
| Node.js | 18.18.2 | Crawl4AI | | - |
| WordPress | 6.4.2 | MariaDB 10.6+ | | MariaDB |
| MariaDB | 10.6.15 | WordPress 6.x | | - |
| Waha | 1.3.0 | n8n 1.x | | - |
| Watchtower | 1.6.1 | Все компоненты | | - |
| Netdata | v1.43.0 | Все компоненты | | - |

## Рекомендации по обновлению

При обновлении компонентов стека рекомендуется соблюдать следующие правила:

1. **Обновлять компоненты постепенно**:
   - Сначала обновлять базы данных (PostgreSQL, MariaDB)
   - Затем обновлять сервисы, зависящие от них (n8n, WordPress)
   - В последнюю очередь обновлять вспомогательные сервисы (Watchtower, Netdata)

2. **Всегда создавать резервные копии перед обновлением**:
   - Резервные копии всех томов Docker
   - Резервные копии конфигурационных файлов
   
3. **Тестировать обновления в отдельном окружении**:
   - По возможности создавать тестовое окружение для проверки обновлений
   - Проверять работоспособность всех компонентов после обновления

4. **Отслеживать изменения в новых версиях**:
   - Изучать списки изменений (changelogs) новых версий
   - Обращать особое внимание на breaking changes

## Процедура отката

В случае проблем после обновления, следуйте процедуре отката:

1. Остановить все сервисы:
   ```bash
   sudo docker compose -f /opt/docker-compose.yaml down
   ```

2. Восстановить предыдущую версию из резервной копии:
   ```bash
   # Восстановить предыдущую версию docker-compose.yaml
   sudo cp /opt/backups/docker-compose.yaml.prev /opt/docker-compose.yaml
   
   # Восстановить данные из резервных копий при необходимости
   ```

3. Запустить сервисы с предыдущей версией:
   ```bash
   sudo docker compose -f /opt/docker-compose.yaml up -d
   ```

4. Проверить работоспособность всех сервисов и документировать проблему
