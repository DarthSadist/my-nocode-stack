# Тестирование локализации и интернационализации

## Введение

Данный документ описывает методологию, инструменты и процедуры для тестирования локализации и интернационализации компонентов NoCode Stack. Целью тестирования является обеспечение корректной работы всех компонентов системы в разных языковых и региональных настройках.

## Терминология

- **Интернационализация (i18n)** - процесс проектирования и разработки программного обеспечения, обеспечивающий его адаптируемость к различным языкам и регионам без необходимости внесения изменений в код.
- **Локализация (l10n)** - процесс адаптации программного обеспечения для конкретного языка и региона, включая перевод текстов, форматирование дат, валют и других элементов, специфичных для региона.
- **Местоположение (locale)** - набор параметров, определяющих язык, страну и используемые соглашения.

## Стратегия тестирования локализации

### Основные принципы

1. **Раннее начало тестирования** - тестирование локализации должно начинаться на ранних этапах разработки
2. **Автоматизация** - использование автоматических инструментов для проверки базовых аспектов локализации
3. **Кросс-платформенность** - тестирование на различных платформах и устройствах
4. **Привлечение носителей языка** - для проверки качества перевода и культурных особенностей

### Типы тестирования локализации

1. **Функциональное тестирование** - проверка функциональности в разных языковых настройках
2. **Лингвистическое тестирование** - проверка качества и точности перевода
3. **Космическое тестирование** - проверка достаточности пространства для отображения текста
4. **Культурное тестирование** - проверка соответствия культурным нормам и традициям

## Поддерживаемые языки и регионы

NoCode Stack поддерживает следующие основные языки и регионы:

1. **Основные языки**:
   - Английский (en-US, en-GB)
   - Русский (ru-RU)
   - Испанский (es-ES, es-MX)
   - Французский (fr-FR, fr-CA)
   - Немецкий (de-DE)
   - Китайский (zh-CN, zh-TW)
   - Японский (ja-JP)

2. **Региональные форматы**:
   - Форматы даты и времени
   - Форматы чисел и валют
   - Форматы адресов
   - Правила сортировки

## Инструменты для тестирования локализации

### Инструменты для автоматизированного тестирования

| Инструмент | Описание | Основное применение |
|------------|----------|---------------------|
| i18n-checker | Инструмент для проверки интернационализации сайтов | Проверка соответствия стандартам i18n |
| GNU gettext | Система интернационализации и локализации | Работа с файлами переводов |
| Weblate | Система управления переводами | Управление локализованными строками |
| Linguist | Анализатор перевода и локализации | Автоматическая проверка перевода |

### Инструменты для ручного тестирования

| Инструмент | Описание | Основное применение |
|------------|----------|---------------------|
| Locale Emulator | Эмулятор локальных настроек | Тестирование в различных локалях |
| Screenshot Comparison | Инструменты для сравнения скриншотов | Визуальное сравнение интерфейсов |
| Browser Language Switcher | Расширение для браузера | Быстрое переключение языка браузера |

## Процесс тестирования локализации

### 1. Подготовка к тестированию

- Определение целевых языков и регионов
- Подготовка тестовых данных для различных языков
- Настройка окружения для тестирования
- Подготовка чек-листов для проверки

### 2. Автоматизированное тестирование интернационализации

- Проверка наличия строк в файлах локализации
- Валидация форматирования строк с подстановками
- Проверка кодировки файлов
- Валидация XML/JSON структуры файлов локализации

### 3. Функциональное тестирование с различными локалями

- Проверка функциональности компонентов в разных языковых настройках
- Тестирование ввода и обработки данных с учетом локали
- Проверка корректности работы поиска и сортировки
- Тестирование интеграции с внешними системами

### 4. Визуальное тестирование

- Проверка отображения интерфейса с текстами разной длины
- Проверка корректности отображения специальных символов
- Оценка расположения элементов интерфейса
- Проверка корректности направления текста (LTR, RTL)

### 5. Лингвистическое тестирование

- Проверка качества перевода носителями языка
- Оценка соответствия терминологии
- Проверка контекстной уместности переводов
- Выявление культурных несоответствий

## Чек-лист для тестирования локализации

### Базовые проверки интернационализации

1. **Кодировка и символы**
   - [ ] Корректное отображение символов всех поддерживаемых языков
   - [ ] Поддержка ввода символов разных языков
   - [ ] Корректная обработка специальных символов в строках

2. **Форматирование данных**
   - [ ] Корректное форматирование дат в соответствии с локалью
   - [ ] Правильное отображение чисел и валют
   - [ ] Соответствие формата адресов региональным стандартам

3. **Файлы ресурсов**
   - [ ] Наличие всех строк в файлах локализации
   - [ ] Соответствие ключей в разных языковых файлах
   - [ ] Корректность форматирования строк с подстановками

### Проверки пользовательского интерфейса

1. **Компоновка и макет**
   - [ ] Корректное отображение интерфейса при разной длине текста
   - [ ] Отсутствие перекрытия элементов интерфейса
   - [ ] Правильное выравнивание для RTL языков

2. **Отображение контента**
   - [ ] Корректное отображение дат и времени
   - [ ] Правильное форматирование чисел и валют
   - [ ] Соответствие единиц измерения региональным стандартам

3. **Интерактивные элементы**
   - [ ] Корректная работа поиска с учетом локали
   - [ ] Правильная сортировка данных в соответствии с языковыми правилами
   - [ ] Корректная валидация вводимых данных

### Проверки контента

1. **Качество перевода**
   - [ ] Отсутствие грамматических и орфографических ошибок
   - [ ] Соответствие терминологии предметной области
   - [ ] Естественность и понятность текста для носителей языка

2. **Культурные аспекты**
   - [ ] Соответствие графических элементов культурным нормам
   - [ ] Корректность использования цветов и символов
   - [ ] Учет культурных особенностей целевых регионов

## Скрипт для автоматической проверки локализации

```bash
#!/bin/bash
# Скрипт для проверки файлов локализации
# Сохраните как ~/my-nocode-stack/test-scripts/check-localization.sh

LOGS_DIR="$HOME/my-nocode-stack/test-logs/localization"
REPORTS_DIR="$HOME/my-nocode-stack/test-reports/localization"
LOCALE_DIR="$HOME/my-nocode-stack/locales"

# Создание директорий для логов и отчетов
mkdir -p "$LOGS_DIR"
mkdir -p "$REPORTS_DIR"

# Определение цветов для вывода
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
RESET='\033[0m'

echo -e "${GREEN}Запуск проверки файлов локализации...${RESET}"

# Проверка наличия директории с локализациями
if [ ! -d "$LOCALE_DIR" ]; then
    echo -e "${RED}Директория с локализациями не найдена: $LOCALE_DIR${RESET}"
    exit 1
fi

# Получение списка доступных языков
LANGUAGES=$(find "$LOCALE_DIR" -type d -depth 1 -exec basename {} \;)

# Перебор всех языковых файлов
BASE_LANGUAGE="en-US"
BASE_FILES=$(find "$LOCALE_DIR/$BASE_LANGUAGE" -type f -name "*.json")

# Функция для проверки JSON-файла
check_json() {
    local file=$1
    if ! jq empty "$file" 2>/dev/null; then
        echo -e "${RED}Ошибка в JSON-файле: $file${RESET}"
        return 1
    fi
    return 0
}

# Проверка наличия и корректности файлов для всех языков
for lang in $LANGUAGES; do
    echo -e "\n${YELLOW}Проверка локализации для языка: $lang${RESET}"
    
    # Пропускаем базовый язык
    if [ "$lang" = "$BASE_LANGUAGE" ]; then
        continue
    fi
    
    # Проверяем каждый файл из базового языка
    for base_file in $BASE_FILES; do
        base_file_name=$(basename "$base_file")
        relative_path=${base_file#"$LOCALE_DIR/$BASE_LANGUAGE/"}
        target_file="$LOCALE_DIR/$lang/${relative_path}"
        
        # Проверка наличия файла
        if [ ! -f "$target_file" ]; then
            echo -e "${RED}Отсутствует файл локализации: $target_file${RESET}"
            continue
        fi
        
        # Проверка корректности JSON
        if ! check_json "$target_file"; then
            continue
        fi
        
        # Сравнение ключей в файлах
        base_keys=$(jq -r 'keys[]' "$base_file" | sort)
        target_keys=$(jq -r 'keys[]' "$target_file" | sort)
        
        # Находим отсутствующие ключи
        missing_keys=$(comm -23 <(echo "$base_keys") <(echo "$target_keys"))
        
        if [ -n "$missing_keys" ]; then
            echo -e "${RED}В файле $target_file отсутствуют следующие ключи:${RESET}"
            echo "$missing_keys"
        else
            echo -e "${GREEN}Файл $target_file содержит все необходимые ключи${RESET}"
        fi
        
        # Проверка наличия пустых значений
        empty_values=$(jq -r 'to_entries[] | select(.value == "") | .key' "$target_file")
        
        if [ -n "$empty_values" ]; then
            echo -e "${YELLOW}В файле $target_file следующие ключи имеют пустые значения:${RESET}"
            echo "$empty_values"
        fi
    done
done

# Создание отчета
REPORT_FILE="$REPORTS_DIR/localization_check_$(date +%Y%m%d_%H%M%S).md"

echo "# Отчет о проверке локализации" > "$REPORT_FILE"
echo "" >> "$REPORT_FILE"
echo "Дата проверки: $(date +"%Y-%m-%d %H:%M:%S")" >> "$REPORT_FILE"
echo "" >> "$REPORT_FILE"
echo "## Проверенные языки" >> "$REPORT_FILE"
echo "" >> "$REPORT_FILE"

for lang in $LANGUAGES; do
    echo "- $lang" >> "$REPORT_FILE"
done

echo "" >> "$REPORT_FILE"
echo "## Результаты проверки" >> "$REPORT_FILE"
echo "" >> "$REPORT_FILE"

for lang in $LANGUAGES; do
    if [ "$lang" = "$BASE_LANGUAGE" ]; then
        continue
    fi
    
    echo "### Язык: $lang" >> "$REPORT_FILE"
    echo "" >> "$REPORT_FILE"
    
    missing_files_count=0
    invalid_json_count=0
    missing_keys_count=0
    empty_values_count=0
    
    for base_file in $BASE_FILES; do
        relative_path=${base_file#"$LOCALE_DIR/$BASE_LANGUAGE/"}
        target_file="$LOCALE_DIR/$lang/${relative_path}"
        
        if [ ! -f "$target_file" ]; then
            missing_files_count=$((missing_files_count + 1))
            continue
        fi
        
        if ! check_json "$target_file" > /dev/null 2>&1; then
            invalid_json_count=$((invalid_json_count + 1))
            continue
        fi
        
        base_keys=$(jq -r 'keys[]' "$base_file" | sort)
        target_keys=$(jq -r 'keys[]' "$target_file" | sort)
        
        missing_keys=$(comm -23 <(echo "$base_keys") <(echo "$target_keys"))
        empty_values=$(jq -r 'to_entries[] | select(.value == "") | .key' "$target_file")
        
        if [ -n "$missing_keys" ]; then
            missing_keys_count=$((missing_keys_count + $(echo "$missing_keys" | wc -l)))
        fi
        
        if [ -n "$empty_values" ]; then
            empty_values_count=$((empty_values_count + $(echo "$empty_values" | wc -l)))
        fi
    done
    
    echo "- Отсутствующие файлы: $missing_files_count" >> "$REPORT_FILE"
    echo "- Некорректные JSON-файлы: $invalid_json_count" >> "$REPORT_FILE"
    echo "- Отсутствующие ключи: $missing_keys_count" >> "$REPORT_FILE"
    echo "- Пустые значения: $empty_values_count" >> "$REPORT_FILE"
    echo "" >> "$REPORT_FILE"
done

echo -e "${GREEN}Проверка локализации завершена. Отчет сохранен в: $REPORT_FILE${RESET}"
```

## Тестирование локализации в CI/CD

Локализационное тестирование может быть интегрировано в процесс CI/CD:

```yaml
name: Localization Testing

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  i18n-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'

      - name: Install dependencies
        run: npm install

      - name: Check localization files
        run: |
          chmod +x ./test-scripts/check-localization.sh
          ./test-scripts/check-localization.sh

      - name: Run pseudo-localization test
        run: |
          npm install -g pseudo-localization
          pseudo-localize ./locales/en-US/messages.json > ./locales/pseudo/messages.json
          # Add test to ensure UI can handle pseudo-localized text
```

## Рекомендации по тестированию локализации

### Подготовка к тестированию

1. **Создание тестовых кейсов с учетом особенностей локали**
   - Добавление тестов с различными форматами дат, чисел, валют
   - Учет региональных особенностей ввода данных
   - Проверка специфических для региона сценариев

2. **Подготовка тестовых данных для разных языков**
   - Создание тестовых данных с использованием символов разных языков
   - Подготовка текстов различной длины
   - Учет особенностей различных алфавитов

3. **Создание эталонных скриншотов**
   - Подготовка скриншотов интерфейса для разных языков
   - Документирование ожидаемого поведения
   - Создание описания культурных особенностей

### Лучшие практики

1. **Использование ресурсов с динамической загрузкой**
   - Реализация "ленивой" загрузки языковых ресурсов
   - Разделение ресурсов на модули
   - Кэширование языковых пакетов

2. **Обеспечение расширяемости для новых языков**
   - Проектирование системы с учетом добавления новых языков
   - Минимизация зависимостей от конкретных языков в коде
   - Реализация универсальных механизмов форматирования

3. **Регулярное обновление переводов**
   - Отслеживание изменений в основном языке
   - Своевременное обновление переводов
   - Использование систем управления переводами

## Заключение

Тестирование локализации и интернационализации является важной частью обеспечения качества NoCode Stack для международной аудитории. Правильно локализованная система расширяет потенциальную аудиторию и улучшает пользовательский опыт для представителей разных языковых групп.

Регулярное проведение описанных в данном документе процедур тестирования локализации поможет выявить и устранить проблемы, связанные с использованием системы в различных языковых и культурных контекстах.
