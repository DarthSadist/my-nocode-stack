# Тестирование доступности системы

## Введение

Документ описывает методологию, инструменты и процессы для тестирования доступности компонентов NoCode Stack. Целью тестирования доступности является обеспечение того, чтобы все компоненты системы были доступны для всех пользователей, включая людей с ограниченными возможностями.

## Важность тестирования доступности

Тестирование доступности имеет несколько ключевых преимуществ:

1. **Соответствие стандартам** - соблюдение международных стандартов доступности (WCAG)
2. **Расширение аудитории** - обеспечение доступа к системе для более широкого круга пользователей
3. **Улучшение юзабилити** - повышение общего удобства использования для всех пользователей
4. **Снижение правовых рисков** - предотвращение потенциальных юридических проблем из-за недоступности

## Стандарты доступности

Основным стандартом для тестирования доступности является Web Content Accessibility Guidelines (WCAG), который включает следующие уровни соответствия:

- **WCAG A** - минимальный уровень доступности
- **WCAG AA** - стандартный уровень, рекомендуемый для большинства веб-приложений
- **WCAG AAA** - максимальный уровень доступности

Наша цель - обеспечить соответствие уровню WCAG AA для всех компонентов NoCode Stack.

## Области тестирования доступности

### 1. Воспринимаемость

Информация и компоненты пользовательского интерфейса должны быть представлены способами, которые пользователи могут воспринимать:

- Текстовые альтернативы для нетекстового контента
- Адаптируемый контент, который можно представить различными способами
- Различимый контент с хорошей контрастностью

### 2. Управляемость

Компоненты пользовательского интерфейса и навигация должны быть управляемыми:

- Доступность с клавиатуры
- Достаточное время для чтения и использования контента
- Отсутствие контента, вызывающего судороги или физические реакции
- Навигация и поиск контента

### 3. Понятность

Информация и операции пользовательского интерфейса должны быть понятными:

- Читаемый и понятный текст
- Предсказуемое поведение страниц и компонентов
- Помощь при вводе данных и исправлении ошибок

### 4. Надежность

Контент должен быть достаточно надежным, чтобы его можно было интерпретировать различными пользовательскими агентами:

- Совместимость с текущими и будущими вспомогательными технологиями
- Правильная семантическая структура HTML

## Инструменты для тестирования доступности

### Автоматизированные инструменты

| Инструмент | Описание | Основное применение |
|------------|----------|---------------------|
| Lighthouse | Встроенный в Chrome инструмент для аудита веб-страниц | Общий аудит доступности |
| axe | Библиотека и расширение для браузера для тестирования доступности | Детальное тестирование в процессе разработки |
| WAVE | Расширение для браузера для оценки доступности | Визуальная оценка проблем доступности |
| Pa11y | Инструмент для автоматизированного тестирования доступности | Интеграция в CI/CD |

### Ручные проверки

| Метод | Описание | Когда применять |
|-------|----------|-----------------|
| Проверка с клавиатуры | Навигация по странице только с помощью клавиатуры | После каждого значительного обновления UI |
| Тестирование со скринридером | Использование программ экранного доступа | Ежемесячно или после крупных изменений |
| Проверка контрастности | Оценка контрастности текста и элементов интерфейса | При внедрении нового дизайна |
| Тестирование с увеличением | Проверка при различных масштабах страницы | Ежеквартально |

## Процесс тестирования доступности

### 1. Планирование тестирования

- Определение целевого уровня соответствия WCAG
- Определение критериев успеха
- Выбор инструментов и методов тестирования
- Составление расписания тестирования

### 2. Автоматизированное тестирование

- Настройка инструментов автоматизированного тестирования
- Интеграция с процессом CI/CD
- Регулярный запуск автоматизированных тестов
- Анализ результатов и выявление проблем

### 3. Ручное тестирование

- Проведение ручных проверок по чек-листам
- Тестирование с использованием вспомогательных технологий
- Тестирование с участием пользователей с ограниченными возможностями
- Документирование обнаруженных проблем

### 4. Исправление и повторное тестирование

- Приоритизация выявленных проблем
- Разработка решений для исправления проблем
- Внедрение исправлений
- Повторное тестирование для подтверждения устранения проблем

### 5. Мониторинг и поддержание

- Непрерывный мониторинг доступности
- Регулярное обновление стандартов и инструментов
- Обучение команды разработчиков принципам доступности

## Интеграция с CI/CD

Автоматизированное тестирование доступности может быть интегрировано в процесс CI/CD:

```yaml
name: Accessibility Testing

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  accessibility:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'

      - name: Install dependencies
        run: npm install

      - name: Start application
        run: npm run start &
        
      - name: Wait for application
        run: sleep 30
        
      - name: Run Pa11y
        run: |
          npm install -g pa11y-ci
          pa11y-ci --config .pa11yrc.json

      - name: Run Lighthouse CI
        run: |
          npm install -g @lhci/cli
          lhci autorun
```

## Скрипты для тестирования доступности

### Скрипт для автоматического тестирования с использованием Pa11y

```bash
#!/bin/bash
# Скрипт для тестирования доступности с использованием Pa11y
# Сохраните как ~/my-nocode-stack/test-scripts/accessibility-test.sh

LOGS_DIR="$HOME/my-nocode-stack/test-logs/accessibility"
REPORTS_DIR="$HOME/my-nocode-stack/test-reports/accessibility"

# Создание директорий для логов и отчетов
mkdir -p "$LOGS_DIR"
mkdir -p "$REPORTS_DIR"

# Определение цветов для вывода
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
RESET='\033[0m'

# Загрузка переменных окружения
if [ -f "$HOME/my-nocode-stack/.env" ]; then
    source "$HOME/my-nocode-stack/.env"
    DOMAIN_NAME="${DOMAIN_NAME:-example.com}"
else
    echo -e "${RED}Файл .env не найден, используется значение по умолчанию: example.com${RESET}"
    DOMAIN_NAME="example.com"
fi

echo -e "${GREEN}Тестирование доступности веб-компонентов...${RESET}"

# Проверка наличия Pa11y
if ! command -v pa11y &> /dev/null; then
    echo -e "${YELLOW}Pa11y не установлен. Устанавливаем...${RESET}"
    npm install -g pa11y
fi

# Определение списка URL для тестирования
declare -a TARGETS=(
    "http://$DOMAIN_NAME"
    "http://n8n.$DOMAIN_NAME"
    "http://flowise.$DOMAIN_NAME"
    "http://qdrant.$DOMAIN_NAME"
)

# Тестирование каждого URL
for target in "${TARGETS[@]}"; do
    APP_NAME=$(echo $target | awk -F[/:] '{print $4}')
    [ -z "$APP_NAME" ] && APP_NAME="main"
    
    echo -e "${YELLOW}Тестирование доступности $target...${RESET}"
    
    # Имена файлов для отчетов
    HTML_REPORT="$REPORTS_DIR/pa11y_${APP_NAME}_$(date +%Y%m%d_%H%M%S).html"
    JSON_REPORT="$REPORTS_DIR/pa11y_${APP_NAME}_$(date +%Y%m%d_%H%M%S).json"
    LOG_FILE="$LOGS_DIR/pa11y_${APP_NAME}_$(date +%Y%m%d_%H%M%S).log"
    
    # Запуск Pa11y
    echo -e "Запуск тестирования доступности с Pa11y..."
    pa11y --reporter html $target > $HTML_REPORT 2> $LOG_FILE
    pa11y --reporter json $target > $JSON_REPORT 2>> $LOG_FILE
    
    # Анализ результатов
    ERROR_COUNT=$(grep -c "Error:" $LOG_FILE || echo 0)
    WARNING_COUNT=$(grep -c "Warning:" $LOG_FILE || echo 0)
    
    if [ $ERROR_COUNT -gt 0 ]; then
        echo -e "${RED}Обнаружено ошибок доступности: $ERROR_COUNT${RESET}"
    else
        echo -e "${GREEN}Критических ошибок доступности не обнаружено${RESET}"
    fi
    
    if [ $WARNING_COUNT -gt 0 ]; then
        echo -e "${YELLOW}Обнаружено предупреждений: $WARNING_COUNT${RESET}"
    fi
    
    echo -e "Отчеты сохранены в:
- HTML: $HTML_REPORT
- JSON: $JSON_REPORT"
done

echo -e "${GREEN}Тестирование доступности всех компонентов завершено.${RESET}"
```

## Чек-лист для ручного тестирования доступности

### Базовые проверки

1. **Навигация с клавиатуры**
   - [ ] Все интерактивные элементы доступны с клавиатуры
   - [ ] Порядок перехода с Tab логичный и интуитивно понятный
   - [ ] Фокус клавиатуры визуально отображается на всех элементах

2. **Альтернативный текст**
   - [ ] Все изображения имеют альтернативный текст
   - [ ] Декоративные изображения имеют пустой alt="", либо реализованы через CSS
   - [ ] Сложные изображения (графики, диаграммы) имеют подробные описания

3. **Структура страницы**
   - [ ] Используются правильные заголовки h1-h6 в логической последовательности
   - [ ] Страница имеет уникальный и информативный заголовок (title)
   - [ ] Содержимое организовано с использованием семантических элементов

4. **Цвет и контраст**
   - [ ] Соотношение контрастности текста соответствует WCAG AA (минимум 4.5:1)
   - [ ] Информация не передается только с помощью цвета
   - [ ] Текст на изображениях читаемый и имеет достаточный контраст

5. **Формы и элементы управления**
   - [ ] Все поля форм имеют связанные метки (label)
   - [ ] Обязательные поля четко обозначены (не только цветом)
   - [ ] Сообщения об ошибках понятны и привязаны к соответствующим полям

### Расширенные проверки

1. **Адаптивность и масштабирование**
   - [ ] Контент читаем при масштабировании до 200%
   - [ ] Интерфейс адаптируется под различные устройства
   - [ ] Нет горизонтальной прокрутки при масштабировании

2. **Медиаконтент**
   - [ ] Видео имеют субтитры
   - [ ] Аудиоконтент имеет текстовую расшифровку
   - [ ] Аудио и видео не воспроизводятся автоматически

3. **Движущийся контент**
   - [ ] Для анимаций предусмотрена возможность остановки, паузы или скрытия
   - [ ] Нет контента, мигающего более 3 раз в секунду
   - [ ] Автоматическая смена слайдов может быть остановлена

4. **ARIA и вспомогательные технологии**
   - [ ] Динамический контент доступен для скринридеров
   - [ ] ARIA-атрибуты используются правильно и по назначению
   - [ ] Пользовательские компоненты имеют правильные ARIA-роли

## Рекомендации по улучшению доступности

### Общие рекомендации

1. **Внедрение принципов доступности с самого начала**
   - Учет вопросов доступности на этапе проектирования
   - Включение требований доступности в спецификации

2. **Непрерывное обучение команды**
   - Проведение тренингов по вопросам доступности
   - Изучение лучших практик и стандартов

3. **Установление ясных метрик и целей**
   - Определение конкретных показателей доступности
   - Регулярное измерение прогресса

### Технические рекомендации

1. **Семантическая разметка HTML**
   - Использование семантических элементов HTML5
   - Правильная структура заголовков
   - Логическое структурирование контента

2. **Оптимизация для скринридеров**
   - Внедрение ARIA-атрибутов при необходимости
   - Обеспечение логического порядка чтения
   - Предоставление текстовых альтернатив для нетекстового контента

3. **Гибкий дизайн и верстка**
   - Использование относительных единиц измерения
   - Реализация адаптивного дизайна
   - Обеспечение работоспособности при увеличенном масштабе

## Заключение

Тестирование доступности является важной частью комплексного подхода к обеспечению качества NoCode Stack. Следуя описанным в данном документе методологиям, используя рекомендованные инструменты и применяя предложенные практики, можно значительно повысить доступность системы для всех пользователей, включая людей с ограниченными возможностями.

Регулярное проведение тестирования доступности помогает выявлять и устранять барьеры, которые могут мешать использованию системы, тем самым расширяя аудиторию и улучшая общее качество продукта.
